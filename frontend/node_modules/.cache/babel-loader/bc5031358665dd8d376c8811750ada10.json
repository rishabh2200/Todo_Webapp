{"ast":null,"code":"import { dynamicRequire, fill, logger } from '@sentry/utils';\n/** Tracing integration for node-postgres package */\n\nvar Postgres =\n/** @class */\nfunction () {\n  function Postgres() {\n    /**\n     * @inheritDoc\n     */\n    this.name = Postgres.id;\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  Postgres.prototype.setupOnce = function (_, getCurrentHub) {\n    var client;\n\n    try {\n      var pgModule = dynamicRequire(module, 'pg');\n      client = pgModule.Client;\n    } catch (e) {\n      logger.error('Postgres Integration was unable to require `pg` package.');\n      return;\n    }\n    /**\n     * function (query, callback) => void\n     * function (query, params, callback) => void\n     * function (query) => Promise\n     * function (query, params) => Promise\n     */\n\n\n    fill(client.prototype, 'query', function (orig) {\n      return function (config, values, callback) {\n        var _a, _b;\n\n        var scope = getCurrentHub().getScope();\n        var parentSpan = (_a = scope) === null || _a === void 0 ? void 0 : _a.getSpan();\n        var span = (_b = parentSpan) === null || _b === void 0 ? void 0 : _b.startChild({\n          description: typeof config === 'string' ? config : config.text,\n          op: \"db\"\n        });\n\n        if (typeof callback === 'function') {\n          return orig.call(this, config, values, function (err, result) {\n            var _a;\n\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            callback(err, result);\n          });\n        }\n\n        if (typeof values === 'function') {\n          return orig.call(this, config, function (err, result) {\n            var _a;\n\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            values(err, result);\n          });\n        }\n\n        return orig.call(this, config, values).then(function (res) {\n          var _a;\n\n          (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n          return res;\n        });\n      };\n    });\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  Postgres.id = 'Postgres';\n  return Postgres;\n}();\n\nexport { Postgres };","map":null,"metadata":{},"sourceType":"module"}